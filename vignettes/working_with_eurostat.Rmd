---
title: "Working With Eurostat Data"
author: "Daniel Antal, CFA"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Working With Eurostat Data}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
library(iotables)
require(dplyr)
```

Symmetric input-output tables and their auxiliary tables are the most complex, structured statistical products that exit, because they contain relationships among 60x60 industry, the supply and the use of the GDP / GNP, and the income disturbing, trade and transport margins and tax receipts from these industries.

The Eurostat website contains the symmetric input-output data in long form.  Working with this data requires a knowledge of the Eurostat SNA vocabulary to arrange the long data in the correct ordering of rows and columns. This is what the preprocessing functions of iotables handle. 

Apart from handing a vast and not always well-documented vocabulary, the user is often confronted with ‘real-life’ data issues, such as missing rows and columns in certain members states or spelling errors in the vocabulary.  Many hours of testing and exception handling went into the current form of the processing functions, but there are further problems may show up. Most of the testing was done on product x product  type SIOTs, because most member states use them. The functions work with industry x industry SIOTs, but further vocabulary exception may show up in their use. Please report these issues on github or in an email.

You are most likely to work with the product x product tables. For the availability of outher data see `?iotables_download`.

The analytical functions are presented at greater detail in the _Germany 1990_ vignette. The numbering of the equations refers to the [Eurostat Manual of Supply, Use and Input-Output Tables](http://ec.europa.eu/eurostat/documents/3859598/5902113/KS-RA-07-013-EN.PDF/b0b3d71e-3930-4442-94be-70b36cea9b39?version=1.0) (Eurostat Manual, Chapter 15.)

##Getting the data and preprocessing it

The following code, if specifically run (it will not run on default), will download the lastest relevant data from the Eurostat data warehouse, and save it to a directory named *../not_included* . The iotables package uses the other rOpenGov package [Eurostat](https://github.com/rOpenGov/eurostat) with additional processing of the rather complex SIOT bulk files.

The contents of the [not_included](https://github.com/rOpenGov/iotables/tree/master/not_included) directory can be found on GitHub, but they are not released and distributed with the package.

```{r download, eval=FALSE}
#Not run
not_included_directory <- file.path('..', 'not_included')
if ( ! dir.exists(not_included_directory) ) dir.create (not_included_directory)
#The contents of the 'not_included' directory can be found on GitHub, 
#but they are not released and distributed with the package.

naio_10_cp1700 <- iotables_download("naio_10_cp1700", #SIOT
                                    data_directory = not_included_directory ) 
naio_10_cp1620 <- iotables_download("naio_10_cp1620", #margins
                                    data_directory = not_included_directory) 
naio_10_cp1630 <- iotables_download("naio_10_cp1630",  #tax
                                    data_directory = not_included_directory )

#Conforming employment data both sexes from 15 years old, year 2015.
#prod_na vocabulary for product x product conformity
emp_cz <- employment_get(geo = "CZ", year = "2015", sex = "Total",
  age = "Y_GE15", labelling = "prod_na", 
  data_directory = not_included_directory,
  force_download = TRUE)

#Conforming employment data #both sexes from 15 years old, year 2017.
emp_sk <- employment_get(geo = "SK", year = "2017", sex = "Total",
  age = "Y_GE15", labelling = "prod_na",
  data_directory = not_included_directory,
  force_download = TRUE)

save (naio_10_cp1700, naio_10_cp1620, naio_10_cp1630, 
      emp_sk, emp_cz, file = file.path('inst', 'extdata',
                                       'naio_10_product_x_product.rda'))
```

For a quickier building of the vignette, the data is retrieved from the *not_included* directory. The chunk above can reproduce this data file. 

```{r load }
#load from pre-saved file to increase running speed
system.file("extdata", "naio_10_product_x_product.rda", package = "mypackage")
```

In this vignette example the Czech (2015) national currency unit and the Slovak (2010) euro tables are created.  Since the Slovak national currency is the euro, there is no difference between the Slovak national currency unit and euro tables.
